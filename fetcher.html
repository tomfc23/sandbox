<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User ID Scraper</title>
    <style>
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç User ID Scraper</h1>
            <p>Extract user IDs from usernames using API endpoint</p>
        </div>
        
        <div class="content">
            <div class="input-section">
                
                <div class="form-group">
                    <label for="usernames">Usernames (one per line):</label>
                    <textarea id="usernames" placeholder="username3&#10;username4"></textarea>
                </div>
                
                <button class="button" onclick="startScraping()">
                    <span id="buttonText">Start Scraping</span>
                </button>
            </div>
            
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>
            
            <div id="status"></div>
            
            <div class="results" id="results" style="display: none;">
                <div class="result-section">
                    <h3>Successful Entries</h3>
                    <div class="result-list" id="successList"></div>
                </div>
                
                <div class="result-section failed">
                    <h3>Failed Entries</h3>
                    <div class="result-list" id="failedList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_ENDPOINT_URL = "https://api.real.vg/user/{}";
        const HEADERS = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36',
            'Accept': 'application/json, text/plain, */*',
            'Accept-Language': 'en-US,en;q=0.9',
            'Connection': 'keep-alive',
        };

        let isScrapingActive = false;
        let successfulEntries = [];
        let failedUsernames = [];

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function updateProgress(current, total) {
            const percentage = Math.round((current / total) * 100);
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = percentage + '%';
            progressBar.textContent = percentage + '%';
        }

        function updateStatus(message, type = 'processing') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = type === 'processing' ? `<span class="spinner"></span>${message}` : message;
        }

        function displayResults() {
            const resultsDiv = document.getElementById('results');
            const successList = document.getElementById('successList');
            const failedList = document.getElementById('failedList');

            successList.innerHTML = '';
            failedList.innerHTML = '';

            if (successfulEntries.length > 0) {
                successfulEntries.forEach(entry => {
                    const div = document.createElement('div');
                    div.className = 'result-item';
                    div.textContent = entry;
                    successList.appendChild(div);
                });
            } else {
                successList.innerHTML = '<div class="result-item">No successful entries</div>';
            }

            if (failedUsernames.length > 0) {
                failedUsernames.forEach(username => {
                    const div = document.createElement('div');
                    div.className = 'result-item';
                    div.textContent = username;
                    failedList.appendChild(div);
                });
            } else {
                failedList.innerHTML = '<div class="result-item">No failed entries</div>';
            }

            resultsDiv.style.display = 'grid';
        }

        async function fetchUserData(username, workerUrl) {
            try {
                const url = `${workerUrl}?username=${encodeURIComponent(username)}`;
                console.log(`Fetching: ${url}`);
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    mode: 'cors',
                    cache: 'no-cache'
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || `HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log(`Response for ${username}:`, data);
                
                // Check if there's an error in the response
                if (data.error) {
                    return { success: false, error: data.error };
                }

                const userObject = data?.user;
                if (userObject && userObject.id) {
                    return { success: true, id: userObject.id };
                } else {
                    console.log('User object or ID not found in response:', data);
                    return { success: false, error: 'No user ID found in response' };
                }
            } catch (error) {
                console.log(`Error fetching ${username}:`, error.message);
                return { success: false, error: error.message };
            }
        }

        async function startScraping() {
            if (isScrapingActive) return;

            const workerUrl = "https://id-fetcher.tommyek67.workers.dev/";
            const usernamesText = document.getElementById('usernames').value.trim();
            const button = document.querySelector('.button');
            const buttonText = document.getElementById('buttonText');
            const progressContainer = document.getElementById('progressContainer');

            if (!workerUrl) {
                updateStatus('Please enter your Cloudflare Worker URL', 'error');
                return;
            }

            // Basic URL validation
            try {
                new URL(workerUrl);
            } catch (e) {
                updateStatus('Please enter a valid Cloudflare Worker URL', 'error');
                return;
            }

            if (!usernamesText) {
                updateStatus('Please enter at least one username', 'error');
                return;
            }

            const usernames = usernamesText.split('\n').map(u => u.trim()).filter(u => u);
            
            if (usernames.length === 0) {
                updateStatus('Please enter valid usernames', 'error');
                return;
            }

            // Reset arrays
            successfulEntries = [];
            failedUsernames = [];

            // Update UI
            isScrapingActive = true;
            button.disabled = true;
            buttonText.textContent = 'Scraping...';
            progressContainer.style.display = 'block';
            document.getElementById('results').style.display = 'none';

            updateStatus(`Starting to scrape ${usernames.length} usernames using Cloudflare Worker...`);

            for (let i = 0; i < usernames.length; i++) {
                const username = usernames[i];
                updateStatus(`Processing: ${username} (${i + 1}/${usernames.length})`);
                updateProgress(i, usernames.length);

                try {
                    const result = await fetchUserData(username, workerUrl);
                    
                    if (result.success) {
                        successfulEntries.push(`${username},${result.id}`);
                        console.log(`‚úì ${username}: ${result.id}`);
                    } else {
                        failedUsernames.push(username);
                        console.log(`‚úó ${username}: ${result.error}`);
                    }
                } catch (error) {
                    failedUsernames.push(username);
                    console.log(`‚úó ${username}: ${error.message}`);
                }

                // No delay - process as fast as possible
            }

            // Complete
            updateProgress(usernames.length, usernames.length);
            updateStatus(`Scraping complete! Processed ${usernames.length} usernames. 
                         Successful: ${successfulEntries.length}, Failed: ${failedUsernames.length}`, 'complete');

            // Reset button
            isScrapingActive = false;
            button.disabled = false;
            buttonText.textContent = 'Start Scraping';

            // Display results
            displayResults();

            // Hide progress bar immediately after completion
        }

        // Allow Enter key to start scraping when focused on textarea
        document.getElementById('usernames').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                startScraping();
            }
        });
    </script>
</body>
</html>
